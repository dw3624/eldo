generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model corps {
  id               String                @id @db.Uuid
  stock_exchange   stock_exchange_types?
  corp_ticker      String?               @db.VarChar(20)
  corp_name_listed String?               @db.VarChar(200)
  corp_name_local  String?               @db.VarChar(200)
  corp_name_en     String?               @db.VarChar(200)
  country_code     String?               @db.VarChar(3)
  region_large     String?               @db.VarChar(50)
  region_detail    String?               @db.VarChar(100)
  corp_id          String?               @db.VarChar(50)
  biz_id           String?               @db.VarChar(50)
  date_founded     DateTime?             @db.Date
  date_listed      DateTime?             @db.Date
  status_listing   status_listing_types? @default(ac)
  date_suspended   DateTime?             @db.Timestamp(6)
  date_resumption  DateTime?             @db.Timestamp(6)
  cnt_suspended    Int?                  @default(0)
  status_date      DateTime?             @db.Timestamp(6)
  corp_size        corps_sizes?
  group_name       String?               @db.VarChar(200)
  major_holder     String?               @db.VarChar(200)
  ceo_name         String?               @db.VarChar(100)
  addr_local       String?
  addr_en          String?
  homepage         String?               @db.VarChar(500)
  email_addr       String?               @db.VarChar(200)
  tel_no           String?               @db.VarChar(50)
  fax_no           String?               @db.VarChar(50)
  industry_code    String?               @db.VarChar(20)
  settle_period    String?               @db.VarChar(20)
  biz_overview     String?
  sales_info       String?
  created_at       DateTime?             @default(now()) @db.Timestamp(6)
  updated_at       DateTime?             @default(now()) @db.Timestamp(6)
  corps_emsec      corps_emsec[]
  corps_historys   corps_historys[]
  indicators       indicators[]
  reports          reports[]
  statements       statements[]
  stock_events     stock_events[]
  stock_trades     stock_trades[]

  @@unique([stock_exchange, corp_ticker], map: "uk_corp_ticker")
  @@index([stock_exchange], map: "idx_corps_exchange")
  @@index([corp_name_local], map: "idx_corps_name")
  @@index([status_listing], map: "idx_corps_status")
  @@index([corp_ticker], map: "idx_corps_ticker")
}

model corps_emsec {
  id         Int       @id @default(autoincrement())
  corp_id    String    @db.Uuid
  emsec_id   Int
  ratio      Decimal?  @db.Decimal(10, 4)
  rank       Int?
  created_at DateTime? @default(now()) @db.Timestamp(6)
  corps      corps     @relation(fields: [corp_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  emsec      emsec     @relation(fields: [emsec_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([corp_id, emsec_id, rank], map: "uk_corp_emsec")
}

model corps_historys {
  id          Int           @id @default(autoincrement())
  corp_id     String        @db.Uuid
  type        history_types
  order_seq   Int
  name        String        @db.VarChar(200)
  change_date DateTime?     @db.Timestamp(6)
  created_at  DateTime?     @default(now()) @db.Timestamp(6)
  corps       corps         @relation(fields: [corp_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([corp_id, type, order_seq], map: "uk_corp_history")
}

model emsec {
  id              Int           @id @default(autoincrement())
  sector          String?       @db.VarChar(100)
  sector_en       String?       @db.VarChar(100)
  industry        String?       @db.VarChar(100)
  industry_en     String?       @db.VarChar(100)
  sub_industry    String?       @db.VarChar(100)
  sub_industry_en String?       @db.VarChar(100)
  code            String?       @db.VarChar(20)
  caption         String?
  created_at      DateTime?     @default(now()) @db.Timestamp(6)
  corps_emsec     corps_emsec[]
}

model indicators {
  id                               Int        @id @default(autoincrement())
  report_id                        Int
  statement_id                     Int
  corp_id                          String     @db.Uuid
  market_cap_end                   Decimal?   @db.Decimal(20, 2)
  market_cap_open                  Decimal?   @db.Decimal(20, 2)
  market_cap_high                  Decimal?   @db.Decimal(20, 2)
  market_cap_low                   Decimal?   @db.Decimal(20, 2)
  market_cap_avg                   Decimal?   @db.Decimal(20, 2)
  market_cap_prev                  Decimal?   @db.Decimal(20, 2)
  ev_end                           Decimal?   @db.Decimal(20, 2)
  ev_end_avg                       Decimal?   @db.Decimal(20, 2)
  ev_prev                          Decimal?   @db.Decimal(20, 2)
  sps                              Decimal?   @db.Decimal(20, 4)
  ebitdaps                         Decimal?   @db.Decimal(20, 4)
  eps                              Decimal?   @db.Decimal(20, 4)
  cfps                             Decimal?   @db.Decimal(20, 4)
  bps                              Decimal?   @db.Decimal(20, 4)
  psr_end                          Decimal?   @db.Decimal(20, 4)
  psr_avg                          Decimal?   @db.Decimal(20, 4)
  psr_prev                         Decimal?   @db.Decimal(20, 4)
  per_end                          Decimal?   @db.Decimal(20, 4)
  per_avg                          Decimal?   @db.Decimal(20, 4)
  per_prev                         Decimal?   @db.Decimal(20, 4)
  pcr_end                          Decimal?   @db.Decimal(20, 4)
  pcr_avg                          Decimal?   @db.Decimal(20, 4)
  pcr_prev                         Decimal?   @db.Decimal(20, 4)
  ev_sales_end                     Decimal?   @db.Decimal(20, 4)
  ev_sales_avg                     Decimal?   @db.Decimal(20, 4)
  ev_sales_prev                    Decimal?   @db.Decimal(20, 4)
  ev_ebitda_end                    Decimal?   @db.Decimal(20, 4)
  ev_ebitda_avg                    Decimal?   @db.Decimal(20, 4)
  ev_ebitda_prev                   Decimal?   @db.Decimal(20, 4)
  pbr_end                          Decimal?   @db.Decimal(20, 4)
  pbr_avg                          Decimal?   @db.Decimal(20, 4)
  pbr_prev                         Decimal?   @db.Decimal(20, 4)
  gpm                              Decimal?   @db.Decimal(10, 4)
  opm                              Decimal?   @db.Decimal(10, 4)
  npm                              Decimal?   @db.Decimal(10, 4)
  ebitda_margin                    Decimal?   @db.Decimal(10, 4)
  roe                              Decimal?   @db.Decimal(10, 4)
  roa                              Decimal?   @db.Decimal(10, 4)
  roic                             Decimal?   @db.Decimal(10, 4)
  wacc                             Decimal?   @db.Decimal(10, 4)
  revenue_growth_rate              Decimal?   @db.Decimal(10, 4)
  operating_profit_growth_rate     Decimal?   @db.Decimal(10, 4)
  ebitda_growth_rate               Decimal?   @db.Decimal(10, 4)
  net_income_growth_rate           Decimal?   @db.Decimal(10, 4)
  cfo_growth_rate                  Decimal?   @db.Decimal(10, 4)
  equity_growth_rate               Decimal?   @db.Decimal(10, 4)
  operating_margin_growth_rate     Decimal?   @db.Decimal(10, 4)
  ebitda_margin_growth_rate        Decimal?   @db.Decimal(10, 4)
  net_margin_growth_rate           Decimal?   @db.Decimal(10, 4)
  revenue_status                   String?    @db.VarChar(10)
  operating_profit_status          String?    @db.VarChar(10)
  ebitda_status                    String?    @db.VarChar(10)
  net_income_status                String?    @db.VarChar(10)
  revenue_pattern_3y               String?    @db.VarChar(10)
  operating_profit_pattern_3y      String?    @db.VarChar(10)
  ebitda_pattern_3y                String?    @db.VarChar(10)
  net_income_pattern_3y            String?    @db.VarChar(10)
  revenue_cagr_3y                  Decimal?   @db.Decimal(10, 4)
  operating_profit_cagr_3y         Decimal?   @db.Decimal(10, 4)
  operating_margin_cagr_3y         Decimal?   @db.Decimal(10, 4)
  ebitda_cagr_3y                   Decimal?   @db.Decimal(10, 4)
  ebitda_margin_cagr_3y            Decimal?   @db.Decimal(10, 4)
  net_income_cagr_3y               Decimal?   @db.Decimal(10, 4)
  net_margin_cagr_3y               Decimal?   @db.Decimal(10, 4)
  cfo_cagr_3y                      Decimal?   @db.Decimal(10, 4)
  equity_cagr_3y                   Decimal?   @db.Decimal(10, 4)
  revenue_cagr_5y                  Decimal?   @db.Decimal(10, 4)
  operating_profit_cagr_5y         Decimal?   @db.Decimal(10, 4)
  operating_margin_cagr_5y         Decimal?   @db.Decimal(10, 4)
  ebitda_cagr_5y                   Decimal?   @db.Decimal(10, 4)
  ebitda_margin_cagr_5y            Decimal?   @db.Decimal(10, 4)
  net_income_cagr_5y               Decimal?   @db.Decimal(10, 4)
  net_margin_cagr_5y               Decimal?   @db.Decimal(10, 4)
  cfo_cagr_5y                      Decimal?   @db.Decimal(10, 4)
  equity_cagr_5y                   Decimal?   @db.Decimal(10, 4)
  debt_to_equity_ratio             Decimal?   @db.Decimal(10, 4)
  equity_ratio                     Decimal?   @db.Decimal(10, 4)
  net_debt_ratio                   Decimal?   @db.Decimal(10, 4)
  current_ratio                    Decimal?   @db.Decimal(10, 4)
  current_liabilities_ratio        Decimal?   @db.Decimal(10, 4)
  capital_retention_ratio          Decimal?   @db.Decimal(10, 4)
  interest_coverage_ratio          Decimal?   @db.Decimal(10, 4)
  debt_to_equity_ratio_growth_rate Decimal?   @db.Decimal(10, 4)
  equity_ratio_growth_rate         Decimal?   @db.Decimal(10, 4)
  net_debt_ratio_growth_rate       Decimal?   @db.Decimal(10, 4)
  debt_to_equity_ratio_cagr_3y     Decimal?   @db.Decimal(10, 4)
  equity_ratio_cagr_3y             Decimal?   @db.Decimal(10, 4)
  net_debt_ratio_cagr_3y           Decimal?   @db.Decimal(10, 4)
  debt_to_equity_ratio_cagr_5y     Decimal?   @db.Decimal(10, 4)
  equity_ratio_cagr_5y             Decimal?   @db.Decimal(10, 4)
  net_debt_ratio_cagr_5y           Decimal?   @db.Decimal(10, 4)
  ttl_asset_turnover               Decimal?   @db.Decimal(10, 4)
  ttl_liability_turnover           Decimal?   @db.Decimal(10, 4)
  equity_turnover                  Decimal?   @db.Decimal(10, 4)
  fixed_asset_turnover             Decimal?   @db.Decimal(10, 4)
  ar_turnover                      Decimal?   @db.Decimal(10, 4)
  inventory_turnover               Decimal?   @db.Decimal(10, 4)
  ap_turnover                      Decimal?   @db.Decimal(10, 4)
  dividend_payout_ratio            Decimal?   @db.Decimal(10, 4)
  created_at                       DateTime?  @default(now()) @db.Timestamp(6)
  corps                            corps      @relation(fields: [corp_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  reports                          reports    @relation(fields: [report_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  statements                       statements @relation(fields: [statement_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([report_id, statement_id], map: "uk_indicator")
}

model reports {
  id          Int          @id @default(autoincrement())
  corp_id     String       @db.Uuid
  name        String       @db.VarChar(200)
  recept_no   String?      @db.VarChar(100)
  flr_nm      String?      @db.VarChar(100)
  recept_date DateTime     @db.Date
  rm          String?      @db.VarChar(50)
  fiscal_no   Int?
  created_at  DateTime?    @default(now()) @db.Timestamp(6)
  indicators  indicators[]
  corps       corps        @relation(fields: [corp_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  statements  statements[]

  @@unique([corp_id, recept_no, name], map: "uk_report")
  @@index([corp_id], map: "idx_reports_corp")
  @@index([corp_id, recept_date(sort: Desc)], map: "idx_reports_corp_date")
  @@index([recept_date], map: "idx_reports_date")
}

model statements {
  id                    Int          @id @default(autoincrement())
  report_id             Int
  corp_id               String       @db.Uuid
  currency              String?      @db.VarChar(20)
  period_start          DateTime?    @db.Date
  period_end            DateTime?    @db.Date
  assets_ttl            Decimal?     @db.Decimal(20, 2)
  assets_current        Decimal?     @db.Decimal(20, 2)
  cash_ttl              Decimal?     @db.Decimal(20, 2)
  ar_ttl                Decimal?     @db.Decimal(20, 2)
  inventory_ttl         Decimal?     @db.Decimal(20, 2)
  assets_tangible_ttl   Decimal?     @db.Decimal(20, 2)
  assets_intangible_ttl Decimal?     @db.Decimal(20, 2)
  liabilities_ttl       Decimal?     @db.Decimal(20, 2)
  liabilities_current   Decimal?     @db.Decimal(20, 2)
  accounts_payable_ttl  Decimal?     @db.Decimal(20, 2)
  debt_interest_ttl     Decimal?     @db.Decimal(20, 2)
  equity_ttl            Decimal?     @db.Decimal(20, 2)
  equity_common         Decimal?     @db.Decimal(20, 2)
  capital_paid_in       Decimal?     @db.Decimal(20, 2)
  capital_preferred     Decimal?     @db.Decimal(20, 2)
  capital_common        Decimal?     @db.Decimal(20, 2)
  rtd_earnings_ttl      Decimal?     @db.Decimal(20, 2)
  capital_surplus_ttl   Decimal?     @db.Decimal(20, 2)
  surplus_ttl           Decimal?     @db.Decimal(20, 2)
  net_borrowing         Decimal?     @db.Decimal(20, 2)
  nwc                   Decimal?     @db.Decimal(20, 2)
  cfo_ttl               Decimal?     @db.Decimal(20, 2)
  depreciation_ttl      Decimal?     @db.Decimal(20, 2)
  cfi_ttl               Decimal?     @db.Decimal(20, 2)
  capex                 Decimal?     @db.Decimal(20, 2)
  cff_ttl               Decimal?     @db.Decimal(20, 2)
  dividends_ttl         Decimal?     @db.Decimal(20, 2)
  revenue               Decimal?     @db.Decimal(20, 2)
  cogs                  Decimal?     @db.Decimal(20, 2)
  sga_ttl               Decimal?     @db.Decimal(20, 2)
  operating_profit      Decimal?     @db.Decimal(20, 2)
  tax_expense           Decimal?     @db.Decimal(20, 2)
  net_income            Decimal?     @db.Decimal(20, 2)
  net_income_ctrl       Decimal?     @db.Decimal(20, 2)
  ebitda                Decimal?     @db.Decimal(20, 2)
  created_at            DateTime?    @default(now()) @db.Timestamp(6)
  indicators            indicators[]
  corps                 corps        @relation(fields: [corp_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  reports               reports      @relation(fields: [report_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([corp_id, report_id, period_end, period_start], map: "uk_statement")
  @@index([corp_id], map: "idx_statements_corp")
  @@index([report_id], map: "idx_statements_report")
}

model stock_event_types {
  id           Int            @id @default(autoincrement())
  code         event_codes    @unique
  name         String?        @db.VarChar(100)
  code_name    String?        @db.VarChar(100)
  adj_required Boolean?       @default(false)
  caption      String?
  stock_events stock_events[]
}

model stock_events {
  id                   Int               @id @default(autoincrement())
  corp_id              String            @db.Uuid
  event_date           DateTime          @db.Date
  event_id             Int
  event_detail         String?
  adj_required         Boolean?          @default(false)
  price_close_ex_right Decimal?          @db.Decimal(15, 2)
  price_base_ex_right  Decimal?          @db.Decimal(15, 2)
  cash_dividend        Decimal?          @db.Decimal(15, 2)
  adj_factor           Decimal?          @db.Decimal(10, 6)
  created_at           DateTime?         @default(now()) @db.Timestamp(6)
  corps                corps             @relation(fields: [corp_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  stock_event_types    stock_event_types @relation(fields: [event_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([corp_id, event_date, event_id], map: "uk_stock_event")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model stock_trades {
  id               Int       @id @default(autoincrement())
  corp_id          String    @db.Uuid
  trade_date       DateTime  @db.Date
  currency         String?   @default("KRW") @db.VarChar(3)
  floating_shares  BigInt?
  shares_listed    BigInt?
  trade_volume     BigInt?
  trade_value      Decimal?  @db.Decimal(15, 2)
  price_close_raw  Decimal?  @db.Decimal(15, 2)
  price_open_raw   Decimal?  @db.Decimal(15, 2)
  price_high_raw   Decimal?  @db.Decimal(15, 2)
  price_low_raw    Decimal?  @db.Decimal(15, 2)
  market_cap_raw   Decimal?  @db.Decimal(20, 2)
  fluc_tp_cd       Decimal?  @db.Decimal(20, 2)
  change           Decimal?  @db.Decimal(20, 2)
  fluc_rt          Decimal?  @db.Decimal(20, 2)
  price_close_adj  Decimal?  @db.Decimal(15, 2)
  price_open_adj   Decimal?  @db.Decimal(15, 2)
  price_high_adj   Decimal?  @db.Decimal(15, 2)
  price_low_adj    Decimal?  @db.Decimal(15, 2)
  market_cap_adj   Decimal?  @db.Decimal(20, 2)
  net_debt         Decimal?  @db.Decimal(20, 2)
  ev               Decimal?  @db.Decimal(20, 2)
  enterprise_value Decimal?  @db.Decimal(20, 2)
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  corps            corps     @relation(fields: [corp_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([corp_id, trade_date], map: "uk_stock_trade")
}

enum corps_sizes {
  le
  me
  sm
  vs
}

enum event_codes {
  div
  bon
  rig
  spl
  rev
  red
  mer
  spi
  exd
  sus
  del
  new
}

enum history_types {
  corp
  ceo
}

enum status_listing_types {
  ac
  su
  de
}

enum stock_exchange_types {
  krx
  kosdaq
  kospi
  nye
  nasdaq
}
