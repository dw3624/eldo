generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Corps {
  id             String              @id @db.Uuid
  stockExchange  StockExchangeTypes? @map("stock_exchange")
  corpTicker     String?             @map("corp_ticker") @db.VarChar(20)
  corpNameListed String?             @map("corp_name_listed") @db.VarChar(200)
  corpNameLocal  String?             @map("corp_name_local") @db.VarChar(200)
  corpNameEn     String?             @map("corp_name_en") @db.VarChar(200)
  countryCode    String?             @map("country_code") @db.VarChar(3)
  regionLarge    String?             @map("region_large") @db.VarChar(50)
  regionDetail   String?             @map("region_detail") @db.VarChar(100)
  corpId         String?             @map("corp_id") @db.VarChar(50)
  bizId          String?             @map("biz_id") @db.VarChar(50)
  dateFounded    DateTime?           @map("date_founded") @db.Date
  dateListed     DateTime?           @map("date_listed") @db.Date
  statusListing  StatusListingTypes? @default(ac) @map("status_listing")
  dateSuspended  DateTime?           @map("date_suspended") @db.Timestamp(6)
  dateResumption DateTime?           @map("date_resumption") @db.Timestamp(6)
  cntSuspended   Int?                @default(0) @map("cnt_suspended")
  statusDate     DateTime?           @map("status_date") @db.Timestamp(6)
  corpSize       CorpsSizes?         @map("corp_size")
  groupName      String?             @map("group_name") @db.VarChar(200)
  majorHolder    String?             @map("major_holder") @db.VarChar(200)
  ceoName        String?             @map("ceo_name") @db.VarChar(100)
  addrLocal      String?             @map("addr_local")
  addrEn         String?             @map("addr_en")
  homepage       String?             @db.VarChar(500)
  emailAddr      String?             @map("email_addr") @db.VarChar(200)
  telNo          String?             @map("tel_no") @db.VarChar(50)
  faxNo          String?             @map("fax_no") @db.VarChar(50)
  industryCode   String?             @map("industry_code") @db.VarChar(20)
  settlePeriod   String?             @map("settle_period") @db.VarChar(20)
  bizOverview    String?             @map("biz_overview")
  salesInfo      String?             @map("sales_info")
  createdAt      DateTime?           @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime?           @default(now()) @map("updated_at") @db.Timestamp(6)
  corpsEmsec     CorpsEmsec[]
  corpsHistorys  CorpsHistorys[]
  indicators     Indicators[]
  reports        Reports[]
  statements     Statements[]
  stockEvents    StockEvents[]
  stockTrades    StockTrades[]

  @@unique([stockExchange, corpTicker], map: "uk_corp_ticker")
  @@index([stockExchange], map: "idx_corps_exchange")
  @@index([corpNameLocal], map: "idx_corps_name")
  @@index([statusListing], map: "idx_corps_status")
  @@index([corpTicker], map: "idx_corps_ticker")
  @@map("corps")
}

model CorpsEmsec {
  id        Int       @id @default(autoincrement())
  corpId    String    @map("corp_id") @db.Uuid
  emsecId   Int       @map("emsec_id")
  ratio     Decimal?  @db.Decimal(10, 4)
  rank      Int?
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  corps Corps @relation(fields: [corpId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  emsec Emsec @relation(fields: [emsecId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([corpId, emsecId, rank], map: "uk_corp_emsec")
  @@index([emsecId])
  @@map("corps_emsec")
}

model CorpsHistorys {
  id         Int          @id @default(autoincrement())
  corpId     String       @map("corp_id") @db.Uuid
  type       HistoryTypes
  orderSeq   Int          @map("order_seq")
  name       String       @db.VarChar(200)
  changeDate DateTime?    @map("change_date") @db.Timestamp(6)
  createdAt  DateTime?    @default(now()) @map("created_at") @db.Timestamp(6)
  corps      Corps        @relation(fields: [corpId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([corpId, type, orderSeq], map: "uk_corp_history")
  @@map("corps_historys")
}

model Emsec {
  id       Int    @id @default(autoincrement())
  // 계층 구조
  level    String @db.VarChar(20) // 'sector' | 'industry' | 'sub_industry'
  parentId Int?   @map("parent_id")

  // 이름들 (표시용)
  sector        String? @db.VarChar(100)
  sectorEn      String? @map("sector_en") @db.VarChar(100)
  industry      String? @db.VarChar(100)
  industryEn    String? @map("industry_en") @db.VarChar(100)
  subIndustry   String? @map("sub_industry") @db.VarChar(100)
  subIndustryEn String? @map("sub_industry_en") @db.VarChar(100)

  // denormalized anchor (빠른 조회용)
  sectorId   Int? @map("sector_id")
  industryId Int? @map("industry_id")

  // 코드/설명 (보통 leaf에만 존재)
  code    String? @db.VarChar(20)
  caption String?

  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  // Relations (self-relation)
  parent   Emsec?  @relation("EmsecHierarchy", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  children Emsec[] @relation("EmsecHierarchy")

  // Other Relations
  corpsEmsec CorpsEmsec[]
  aggregates IndustryAggregates[]

  @@index([level])
  @@index([parentId])
  @@index([sectorId])
  @@index([industryId])
  @@map("emsec")
}

model Indicators {
  id                          Int        @id @default(autoincrement())
  reportId                    Int?       @map("report_id")
  statementId                 Int        @map("statement_id")
  corpId                      String     @map("corp_id") @db.Uuid
  marketCapEnd                Decimal?   @map("market_cap_end") @db.Decimal(20, 2)
  marketCapOpen               Decimal?   @map("market_cap_open") @db.Decimal(20, 2)
  marketCapHigh               Decimal?   @map("market_cap_high") @db.Decimal(20, 2)
  marketCapLow                Decimal?   @map("market_cap_low") @db.Decimal(20, 2)
  marketCapAvg                Decimal?   @map("market_cap_avg") @db.Decimal(20, 2)
  marketCapPrev               Decimal?   @map("market_cap_prev") @db.Decimal(20, 2)
  evEnd                       Decimal?   @map("ev_end") @db.Decimal(20, 2)
  evEndAvg                    Decimal?   @map("ev_end_avg") @db.Decimal(20, 2)
  evPrev                      Decimal?   @map("ev_prev") @db.Decimal(20, 2)
  sps                         Decimal?   @db.Decimal(20, 4)
  ebitdaps                    Decimal?   @db.Decimal(20, 4)
  eps                         Decimal?   @db.Decimal(20, 4)
  cfps                        Decimal?   @db.Decimal(20, 4)
  bps                         Decimal?   @db.Decimal(20, 4)
  psrEnd                      Decimal?   @map("psr_end") @db.Decimal(20, 4)
  psrAvg                      Decimal?   @map("psr_avg") @db.Decimal(20, 4)
  psrPrev                     Decimal?   @map("psr_prev") @db.Decimal(20, 4)
  perEnd                      Decimal?   @map("per_end") @db.Decimal(20, 4)
  perAvg                      Decimal?   @map("per_avg") @db.Decimal(20, 4)
  perPrev                     Decimal?   @map("per_prev") @db.Decimal(20, 4)
  pcrEnd                      Decimal?   @map("pcr_end") @db.Decimal(20, 4)
  pcrAvg                      Decimal?   @map("pcr_avg") @db.Decimal(20, 4)
  pcrPrev                     Decimal?   @map("pcr_prev") @db.Decimal(20, 4)
  evSalesEnd                  Decimal?   @map("ev_sales_end") @db.Decimal(20, 4)
  evSalesAvg                  Decimal?   @map("ev_sales_avg") @db.Decimal(20, 4)
  evSalesPrev                 Decimal?   @map("ev_sales_prev") @db.Decimal(20, 4)
  evEbitdaEnd                 Decimal?   @map("ev_ebitda_end") @db.Decimal(20, 4)
  evEbitdaAvg                 Decimal?   @map("ev_ebitda_avg") @db.Decimal(20, 4)
  evEbitdaPrev                Decimal?   @map("ev_ebitda_prev") @db.Decimal(20, 4)
  pbrEnd                      Decimal?   @map("pbr_end") @db.Decimal(20, 4)
  pbrAvg                      Decimal?   @map("pbr_avg") @db.Decimal(20, 4)
  pbrPrev                     Decimal?   @map("pbr_prev") @db.Decimal(20, 4)
  gpm                         Decimal?   @db.Decimal(10, 4)
  opm                         Decimal?   @db.Decimal(10, 4)
  npm                         Decimal?   @db.Decimal(10, 4)
  ebitdaMargin                Decimal?   @map("ebitda_margin") @db.Decimal(10, 4)
  roe                         Decimal?   @db.Decimal(10, 4)
  roa                         Decimal?   @db.Decimal(10, 4)
  roic                        Decimal?   @db.Decimal(10, 4)
  wacc                        Decimal?   @db.Decimal(10, 4)
  revenueGrowthRate           Decimal?   @map("revenue_growth_rate") @db.Decimal(10, 4)
  operatingProfitGrowthRate   Decimal?   @map("operating_profit_growth_rate") @db.Decimal(10, 4)
  ebitdaGrowthRate            Decimal?   @map("ebitda_growth_rate") @db.Decimal(10, 4)
  netIncomeGrowthRate         Decimal?   @map("net_income_growth_rate") @db.Decimal(10, 4)
  cfoGrowthRate               Decimal?   @map("cfo_growth_rate") @db.Decimal(10, 4)
  equityGrowthRate            Decimal?   @map("equity_growth_rate") @db.Decimal(10, 4)
  operatingMarginGrowthRate   Decimal?   @map("operating_margin_growth_rate") @db.Decimal(10, 4)
  ebitdaMarginGrowthRate      Decimal?   @map("ebitda_margin_growth_rate") @db.Decimal(10, 4)
  netMarginGrowthRate         Decimal?   @map("net_margin_growth_rate") @db.Decimal(10, 4)
  revenueStatus               String?    @map("revenue_status") @db.VarChar(10)
  operatingProfitStatus       String?    @map("operating_profit_status") @db.VarChar(10)
  ebitdaStatus                String?    @map("ebitda_status") @db.VarChar(10)
  netIncomeStatus             String?    @map("net_income_status") @db.VarChar(10)
  revenuePattern_3y           String?    @map("revenue_pattern_3y") @db.VarChar(10)
  operatingProfitPattern_3y   String?    @map("operating_profit_pattern_3y") @db.VarChar(10)
  ebitdaPattern_3y            String?    @map("ebitda_pattern_3y") @db.VarChar(10)
  netIncomePattern_3y         String?    @map("net_income_pattern_3y") @db.VarChar(10)
  revenueCagr_3y              Decimal?   @map("revenue_cagr_3y") @db.Decimal(10, 4)
  operatingProfitCagr_3y      Decimal?   @map("operating_profit_cagr_3y") @db.Decimal(10, 4)
  operatingMarginCagr_3y      Decimal?   @map("operating_margin_cagr_3y") @db.Decimal(10, 4)
  ebitdaCagr_3y               Decimal?   @map("ebitda_cagr_3y") @db.Decimal(10, 4)
  ebitdaMarginCagr_3y         Decimal?   @map("ebitda_margin_cagr_3y") @db.Decimal(10, 4)
  netIncomeCagr_3y            Decimal?   @map("net_income_cagr_3y") @db.Decimal(10, 4)
  netMarginCagr_3y            Decimal?   @map("net_margin_cagr_3y") @db.Decimal(10, 4)
  cfoCagr_3y                  Decimal?   @map("cfo_cagr_3y") @db.Decimal(10, 4)
  equityCagr_3y               Decimal?   @map("equity_cagr_3y") @db.Decimal(10, 4)
  revenueCagr_5y              Decimal?   @map("revenue_cagr_5y") @db.Decimal(10, 4)
  operatingProfitCagr_5y      Decimal?   @map("operating_profit_cagr_5y") @db.Decimal(10, 4)
  operatingMarginCagr_5y      Decimal?   @map("operating_margin_cagr_5y") @db.Decimal(10, 4)
  ebitdaCagr_5y               Decimal?   @map("ebitda_cagr_5y") @db.Decimal(10, 4)
  ebitdaMarginCagr_5y         Decimal?   @map("ebitda_margin_cagr_5y") @db.Decimal(10, 4)
  netIncomeCagr_5y            Decimal?   @map("net_income_cagr_5y") @db.Decimal(10, 4)
  netMarginCagr_5y            Decimal?   @map("net_margin_cagr_5y") @db.Decimal(10, 4)
  cfoCagr_5y                  Decimal?   @map("cfo_cagr_5y") @db.Decimal(10, 4)
  equityCagr_5y               Decimal?   @map("equity_cagr_5y") @db.Decimal(10, 4)
  debtToEquityRatio           Decimal?   @map("debt_to_equity_ratio") @db.Decimal(10, 4)
  equityRatio                 Decimal?   @map("equity_ratio") @db.Decimal(10, 4)
  netDebtRatio                Decimal?   @map("net_debt_ratio") @db.Decimal(10, 4)
  currentRatio                Decimal?   @map("current_ratio") @db.Decimal(10, 4)
  currentLiabilitiesRatio     Decimal?   @map("current_liabilities_ratio") @db.Decimal(10, 4)
  capitalRetentionRatio       Decimal?   @map("capital_retention_ratio") @db.Decimal(10, 4)
  interestCoverageRatio       Decimal?   @map("interest_coverage_ratio") @db.Decimal(10, 4)
  debtToEquityRatioGrowthRate Decimal?   @map("debt_to_equity_ratio_growth_rate") @db.Decimal(10, 4)
  equityRatioGrowthRate       Decimal?   @map("equity_ratio_growth_rate") @db.Decimal(10, 4)
  netDebtRatioGrowthRate      Decimal?   @map("net_debt_ratio_growth_rate") @db.Decimal(10, 4)
  debtToEquityRatioCagr_3y    Decimal?   @map("debt_to_equity_ratio_cagr_3y") @db.Decimal(10, 4)
  equityRatioCagr_3y          Decimal?   @map("equity_ratio_cagr_3y") @db.Decimal(10, 4)
  netDebtRatioCagr_3y         Decimal?   @map("net_debt_ratio_cagr_3y") @db.Decimal(10, 4)
  debtToEquityRatioCagr_5y    Decimal?   @map("debt_to_equity_ratio_cagr_5y") @db.Decimal(10, 4)
  equityRatioCagr_5y          Decimal?   @map("equity_ratio_cagr_5y") @db.Decimal(10, 4)
  netDebtRatioCagr_5y         Decimal?   @map("net_debt_ratio_cagr_5y") @db.Decimal(10, 4)
  ttlAssetTurnover            Decimal?   @map("ttl_asset_turnover") @db.Decimal(10, 4)
  ttlLiabilityTurnover        Decimal?   @map("ttl_liability_turnover") @db.Decimal(10, 4)
  equityTurnover              Decimal?   @map("equity_turnover") @db.Decimal(10, 4)
  fixedAssetTurnover          Decimal?   @map("fixed_asset_turnover") @db.Decimal(10, 4)
  arTurnover                  Decimal?   @map("ar_turnover") @db.Decimal(10, 4)
  inventoryTurnover           Decimal?   @map("inventory_turnover") @db.Decimal(10, 4)
  apTurnover                  Decimal?   @map("ap_turnover") @db.Decimal(10, 4)
  dividendPayoutRatio         Decimal?   @map("dividend_payout_ratio") @db.Decimal(10, 4)
  createdAt                   DateTime?  @default(now()) @map("created_at") @db.Timestamp(6)
  corps                       Corps      @relation(fields: [corpId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  reports                     Reports?   @relation(fields: [reportId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  statements                  Statements @relation(fields: [statementId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([reportId, statementId], map: "uk_indicator")
  @@map("indicators")
}

model Reports {
  id         Int          @id @default(autoincrement())
  corpId     String       @map("corp_id") @db.Uuid
  name       String       @db.VarChar(200)
  receptNo   String?      @map("recept_no") @db.VarChar(100)
  flrNm      String?      @map("flr_nm") @db.VarChar(100)
  receptDate DateTime     @map("recept_date") @db.Date
  rm         String?      @db.VarChar(50)
  fiscalNo   Int?         @map("fiscal_no")
  createdAt  DateTime?    @default(now()) @map("created_at") @db.Timestamp(6)
  indicators Indicators[]
  corps      Corps        @relation(fields: [corpId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  statements Statements[]

  @@unique([corpId, receptNo, name], map: "uk_report")
  @@index([corpId], map: "idx_reports_corp")
  @@index([corpId, receptDate(sort: Desc)], map: "idx_reports_corp_date")
  @@index([receptDate], map: "idx_reports_date")
  @@map("reports")
}

model Statements {
  id                  Int          @id @default(autoincrement())
  reportId            Int          @map("report_id")
  corpId              String       @map("corp_id") @db.Uuid
  currency            String?      @db.VarChar(20)
  periodStart         DateTime?    @map("period_start") @db.Date
  periodEnd           DateTime?    @map("period_end") @db.Date
  assetsTtl           Decimal?     @map("assets_ttl") @db.Decimal(20, 2)
  assetsCurrent       Decimal?     @map("assets_current") @db.Decimal(20, 2)
  cashTtl             Decimal?     @map("cash_ttl") @db.Decimal(20, 2)
  arTtl               Decimal?     @map("ar_ttl") @db.Decimal(20, 2)
  inventoryTtl        Decimal?     @map("inventory_ttl") @db.Decimal(20, 2)
  assetsTangibleTtl   Decimal?     @map("assets_tangible_ttl") @db.Decimal(20, 2)
  assetsIntangibleTtl Decimal?     @map("assets_intangible_ttl") @db.Decimal(20, 2)
  liabilitiesTtl      Decimal?     @map("liabilities_ttl") @db.Decimal(20, 2)
  liabilitiesCurrent  Decimal?     @map("liabilities_current") @db.Decimal(20, 2)
  accountsPayableTtl  Decimal?     @map("accounts_payable_ttl") @db.Decimal(20, 2)
  debtInterestTtl     Decimal?     @map("debt_interest_ttl") @db.Decimal(20, 2)
  equityTtl           Decimal?     @map("equity_ttl") @db.Decimal(20, 2)
  equityCommon        Decimal?     @map("equity_common") @db.Decimal(20, 2)
  capitalPaidIn       Decimal?     @map("capital_paid_in") @db.Decimal(20, 2)
  capitalPreferred    Decimal?     @map("capital_preferred") @db.Decimal(20, 2)
  capitalCommon       Decimal?     @map("capital_common") @db.Decimal(20, 2)
  rtdEarningsTtl      Decimal?     @map("rtd_earnings_ttl") @db.Decimal(20, 2)
  capitalSurplusTtl   Decimal?     @map("capital_surplus_ttl") @db.Decimal(20, 2)
  surplusTtl          Decimal?     @map("surplus_ttl") @db.Decimal(20, 2)
  netBorrowing        Decimal?     @map("net_borrowing") @db.Decimal(20, 2)
  nwc                 Decimal?     @db.Decimal(20, 2)
  cfoTtl              Decimal?     @map("cfo_ttl") @db.Decimal(20, 2)
  depreciationTtl     Decimal?     @map("depreciation_ttl") @db.Decimal(20, 2)
  cfiTtl              Decimal?     @map("cfi_ttl") @db.Decimal(20, 2)
  capex               Decimal?     @db.Decimal(20, 2)
  cffTtl              Decimal?     @map("cff_ttl") @db.Decimal(20, 2)
  dividendsTtl        Decimal?     @map("dividends_ttl") @db.Decimal(20, 2)
  revenue             Decimal?     @db.Decimal(20, 2)
  cogs                Decimal?     @db.Decimal(20, 2)
  sgaTtl              Decimal?     @map("sga_ttl") @db.Decimal(20, 2)
  operatingProfit     Decimal?     @map("operating_profit") @db.Decimal(20, 2)
  taxExpense          Decimal?     @map("tax_expense") @db.Decimal(20, 2)
  netIncome           Decimal?     @map("net_income") @db.Decimal(20, 2)
  netIncomeCtrl       Decimal?     @map("net_income_ctrl") @db.Decimal(20, 2)
  ebitda              Decimal?     @db.Decimal(20, 2)
  createdAt           DateTime?    @default(now()) @map("created_at") @db.Timestamp(6)
  indicators          Indicators[]
  corps               Corps        @relation(fields: [corpId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  reports             Reports      @relation(fields: [reportId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([corpId, reportId, periodEnd, periodStart], map: "uk_statement")
  @@index([corpId], map: "idx_statements_corp")
  @@index([reportId], map: "idx_statements_report")
  @@map("statements")
}

model StockEventTypes {
  id          Int           @id @default(autoincrement())
  code        EventCodes    @unique
  name        String?       @db.VarChar(100)
  codeName    String?       @map("code_name") @db.VarChar(100)
  adjRequired Boolean?      @default(false) @map("adj_required")
  caption     String?
  stockEvents StockEvents[]

  @@map("stock_event_types")
}

model StockEvents {
  id                Int             @id @default(autoincrement())
  corpId            String          @map("corp_id") @db.Uuid
  eventDate         DateTime        @map("event_date") @db.Date
  eventId           Int             @map("event_id")
  eventDetail       String?         @map("event_detail")
  adjRequired       Boolean?        @default(false) @map("adj_required")
  priceCloseExRight Decimal?        @map("price_close_ex_right") @db.Decimal(15, 2)
  priceBaseExRight  Decimal?        @map("price_base_ex_right") @db.Decimal(15, 2)
  cashDividend      Decimal?        @map("cash_dividend") @db.Decimal(15, 2)
  adjFactor         Decimal?        @map("adj_factor") @db.Decimal(10, 6)
  createdAt         DateTime?       @default(now()) @map("created_at") @db.Timestamp(6)
  corps             Corps           @relation(fields: [corpId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  stockEventTypes   StockEventTypes @relation(fields: [eventId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([corpId, eventDate, eventId], map: "uk_stock_event")
  @@map("stock_events")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model StockTrades {
  id              Int       @id @default(autoincrement())
  corpId          String    @map("corp_id") @db.Uuid
  tradeDate       DateTime  @map("trade_date") @db.Date
  currency        String?   @default("KRW") @db.VarChar(3)
  floatingShares  BigInt?   @map("floating_shares")
  sharesListed    BigInt?   @map("shares_listed")
  tradeVolume     BigInt?   @map("trade_volume")
  tradeValue      Decimal?  @map("trade_value") @db.Decimal(15, 2)
  priceCloseRaw   Decimal?  @map("price_close_raw") @db.Decimal(15, 2)
  priceOpenRaw    Decimal?  @map("price_open_raw") @db.Decimal(15, 2)
  priceHighRaw    Decimal?  @map("price_high_raw") @db.Decimal(15, 2)
  priceLowRaw     Decimal?  @map("price_low_raw") @db.Decimal(15, 2)
  marketCapRaw    Decimal?  @map("market_cap_raw") @db.Decimal(20, 2)
  flucTpCd        Decimal?  @map("fluc_tp_cd") @db.Decimal(20, 2)
  change          Decimal?  @db.Decimal(20, 2)
  flucRt          Decimal?  @map("fluc_rt") @db.Decimal(20, 2)
  priceCloseAdj   Decimal?  @map("price_close_adj") @db.Decimal(15, 2)
  priceOpenAdj    Decimal?  @map("price_open_adj") @db.Decimal(15, 2)
  priceHighAdj    Decimal?  @map("price_high_adj") @db.Decimal(15, 2)
  priceLowAdj     Decimal?  @map("price_low_adj") @db.Decimal(15, 2)
  marketCapAdj    Decimal?  @map("market_cap_adj") @db.Decimal(20, 2)
  netDebt         Decimal?  @map("net_debt") @db.Decimal(20, 2)
  ev              Decimal?  @db.Decimal(20, 2)
  enterpriseValue Decimal?  @map("enterprise_value") @db.Decimal(20, 2)
  createdAt       DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  corps           Corps     @relation(fields: [corpId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([corpId, tradeDate], map: "uk_stock_trade")
  @@map("stock_trades")
}

model IndustryAggregates {
  id Int @id @default(autoincrement())

  // 집계 기준 노드 (sector면 sector 노드 id, industry면 industry 노드 id, sub_industry면 leaf id)
  emsecId Int   @map("emsec_id")
  emsec   Emsec @relation(fields: [emsecId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  // 계층/앵커
  level      String @db.VarChar(20) // 'sector' | 'industry' | 'sub_industry'
  sectorId   Int?   @map("sector_id")
  industryId Int?   @map("industry_id")

  // 표시용 이름(denormalized; 조회 편의)
  sector        String  @db.VarChar(100)
  sectorEn      String  @map("sector_en") @db.VarChar(100)
  industry      String? @db.VarChar(100)
  industryEn    String? @map("industry_en") @db.VarChar(100)
  subIndustry   String? @map("sub_industry") @db.VarChar(100)
  subIndustryEn String? @map("sub_industry_en") @db.VarChar(100)

  fiscalYear    String @map("fiscal_year") @db.VarChar(20)
  stockExchange String @map("stock_exchange") @db.VarChar(20)

  // 기업수 관련
  corpCount          Int     @map("corp_count")
  corpCountCollected Int     @map("corp_count_collected")
  corpCountMissing   Int     @map("corp_count_missing")
  missingRatio       Decimal @map("missing_ratio") @db.Decimal(10, 4)

  // 0 이하 비율
  revenueZeroRatio   Decimal @map("revenue_zero_ratio") @db.Decimal(10, 4)
  ebitdaZeroRatio    Decimal @map("ebitda_zero_ratio") @db.Decimal(10, 4)
  netIncomeZeroRatio Decimal @map("net_income_zero_ratio") @db.Decimal(10, 4)
  equityZeroRatio    Decimal @map("equity_zero_ratio") @db.Decimal(10, 4)
  cfoZeroRatio       Decimal @map("cfo_zero_ratio") @db.Decimal(10, 4)

  // 시가총액 통계
  avgMarketCap Decimal? @map("avg_market_cap") @db.Decimal(20, 2)
  medMarketCap Decimal? @map("med_market_cap") @db.Decimal(20, 2)
  sumMarketCap Decimal? @map("sum_market_cap") @db.Decimal(20, 2) // 합계 추가
  minMarketCap Decimal? @map("min_market_cap") @db.Decimal(20, 2)
  maxMarketCap Decimal? @map("max_market_cap") @db.Decimal(20, 2)

  // 자산총계 통계
  avgAssets Decimal? @map("avg_assets") @db.Decimal(20, 2)
  medAssets Decimal? @map("med_assets") @db.Decimal(20, 2)
  sumAssets Decimal? @map("sum_assets") @db.Decimal(20, 2) // 합계 추가
  minAssets Decimal? @map("min_assets") @db.Decimal(20, 2)
  maxAssets Decimal? @map("max_assets") @db.Decimal(20, 2)

  // 매출액 통계
  avgRevenue Decimal? @map("avg_revenue") @db.Decimal(20, 2)
  medRevenue Decimal? @map("med_revenue") @db.Decimal(20, 2)
  sumRevenue Decimal? @map("sum_revenue") @db.Decimal(20, 2) // 합계 추가
  minRevenue Decimal? @map("min_revenue") @db.Decimal(20, 2)
  maxRevenue Decimal? @map("max_revenue") @db.Decimal(20, 2)

  // 상장일 분포
  listedUnder1y        Int      @map("listed_under_1y")
  listed1to3y          Int      @map("listed_1to3y")
  listed3to5y          Int      @map("listed_3to5y")
  listed5to10y         Int      @map("listed_5to10y")
  listed10to20y        Int      @map("listed_10to20y")
  listedOver20y        Int      @map("listed_over_20y")
  avgYearsSinceListing Decimal? @map("avg_years_since_listing") @db.Decimal(10, 2)
  medYearsSinceListing Decimal? @map("med_years_since_listing") @db.Decimal(10, 2)

  // 멀티플 지표
  avgPer      Decimal? @map("avg_per") @db.Decimal(20, 4)
  medPer      Decimal? @map("med_per") @db.Decimal(20, 4)
  avgPsr      Decimal? @map("avg_psr") @db.Decimal(20, 4)
  medPsr      Decimal? @map("med_psr") @db.Decimal(20, 4)
  avgPcr      Decimal? @map("avg_pcr") @db.Decimal(20, 4)
  medPcr      Decimal? @map("med_pcr") @db.Decimal(20, 4)
  avgPbr      Decimal? @map("avg_pbr") @db.Decimal(20, 4)
  medPbr      Decimal? @map("med_pbr") @db.Decimal(20, 4)
  avgEvEbitda Decimal? @map("avg_ev_ebitda") @db.Decimal(20, 4)
  medEvEbitda Decimal? @map("med_ev_ebitda") @db.Decimal(20, 4)

  // 수익성 지표
  avgRoe          Decimal? @map("avg_roe") @db.Decimal(10, 4)
  medRoe          Decimal? @map("med_roe") @db.Decimal(10, 4)
  avgRoa          Decimal? @map("avg_roa") @db.Decimal(10, 4)
  medRoa          Decimal? @map("med_roa") @db.Decimal(10, 4)
  avgRoic         Decimal? @map("avg_roic") @db.Decimal(10, 4)
  medRoic         Decimal? @map("med_roic") @db.Decimal(10, 4)
  avgGpm          Decimal? @map("avg_gpm") @db.Decimal(10, 4)
  medGpm          Decimal? @map("med_gpm") @db.Decimal(10, 4)
  avgOpm          Decimal? @map("avg_opm") @db.Decimal(10, 4)
  medOpm          Decimal? @map("med_opm") @db.Decimal(10, 4)
  avgNpm          Decimal? @map("avg_npm") @db.Decimal(10, 4)
  medNpm          Decimal? @map("med_npm") @db.Decimal(10, 4)
  avgEbitdaMargin Decimal? @map("avg_ebitda_margin") @db.Decimal(10, 4)
  medEbitdaMargin Decimal? @map("med_ebitda_margin") @db.Decimal(10, 4)

  // 성장성 지표
  avgRevenueGrowth         Decimal? @map("avg_revenue_growth") @db.Decimal(10, 4)
  medRevenueGrowth         Decimal? @map("med_revenue_growth") @db.Decimal(10, 4)
  avgOperatingProfitGrowth Decimal? @map("avg_operating_profit_growth") @db.Decimal(10, 4)
  medOperatingProfitGrowth Decimal? @map("med_operating_profit_growth") @db.Decimal(10, 4)
  avgNetIncomeGrowth       Decimal? @map("avg_net_income_growth") @db.Decimal(10, 4)
  medNetIncomeGrowth       Decimal? @map("med_net_income_growth") @db.Decimal(10, 4)
  avgRevenueCagr3y         Decimal? @map("avg_revenue_cagr_3y") @db.Decimal(10, 4)
  medRevenueCagr3y         Decimal? @map("med_revenue_cagr_3y") @db.Decimal(10, 4)
  avgRevenueCagr5y         Decimal? @map("avg_revenue_cagr_5y") @db.Decimal(10, 4)
  medRevenueCagr5y         Decimal? @map("med_revenue_cagr_5y") @db.Decimal(10, 4)

  // 안정성 지표
  avgDebtToEquity     Decimal? @map("avg_debt_to_equity") @db.Decimal(10, 4)
  medDebtToEquity     Decimal? @map("med_debt_to_equity") @db.Decimal(10, 4)
  avgEquityRatio      Decimal? @map("avg_equity_ratio") @db.Decimal(10, 4)
  medEquityRatio      Decimal? @map("med_equity_ratio") @db.Decimal(10, 4)
  avgCurrentRatio     Decimal? @map("avg_current_ratio") @db.Decimal(10, 4)
  medCurrentRatio     Decimal? @map("med_current_ratio") @db.Decimal(10, 4)
  avgInterestCoverage Decimal? @map("avg_interest_coverage") @db.Decimal(10, 4)
  medInterestCoverage Decimal? @map("med_interest_coverage") @db.Decimal(10, 4)

  // 활동성 지표
  avgAssetTurnover     Decimal? @map("avg_asset_turnover") @db.Decimal(10, 4)
  medAssetTurnover     Decimal? @map("med_asset_turnover") @db.Decimal(10, 4)
  avgInventoryTurnover Decimal? @map("avg_inventory_turnover") @db.Decimal(10, 4)
  medInventoryTurnover Decimal? @map("med_inventory_turnover") @db.Decimal(10, 4)
  avgArTurnover        Decimal? @map("avg_ar_turnover") @db.Decimal(10, 4)
  medArTurnover        Decimal? @map("med_ar_turnover") @db.Decimal(10, 4)

  // 환원성 지표
  avgDividendPayout Decimal? @map("avg_dividend_payout") @db.Decimal(10, 4)
  medDividendPayout Decimal? @map("med_dividend_payout") @db.Decimal(10, 4)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)

  @@unique([emsecId, fiscalYear, stockExchange], map: "uk_industry_agg_key")
  @@index([level])
  @@index([sectorId])
  @@index([industryId])
  @@index([fiscalYear])
  @@index([stockExchange])
  @@map("industry_aggregates")
}

enum CorpsSizes {
  le
  me
  sm
  vs

  @@map("corps_sizes")
}

enum EventCodes {
  div
  bon
  rig
  spl
  rev
  red
  mer
  spi
  exd
  sus
  del
  new

  @@map("event_codes")
}

enum HistoryTypes {
  corp
  ceo

  @@map("history_types")
}

enum StatusListingTypes {
  ac
  su
  de

  @@map("status_listing_types")
}

enum StockExchangeTypes {
  krx
  kosdaq
  kospi
  nye
  nasdaq

  @@map("stock_exchange_types")
}
